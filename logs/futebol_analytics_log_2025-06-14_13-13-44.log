2025-06-14 13:13:44 - MainApp - INFO - APP_DIR (launcher): c:\Users\princ\Desktop\modelagem\Modelagem_Exemplos\futebol_analytics\src
2025-06-14 13:13:44 - MainApp - INFO - SRC_DIR: c:\Users\princ\Desktop\modelagem\Modelagem_Exemplos\futebol_analytics\src
2025-06-14 13:13:44 - MainApp - INFO - BASE_DIR: c:\Users\princ\Desktop\modelagem\Modelagem_Exemplos\futebol_analytics
2025-06-14 13:13:44 - MainApp - INFO - sys.path includes SRC_DIR?: True, BASE_DIR?: True
2025-06-14 13:13:49 - Config - INFO - Biblioteca 'catboost' carregada.
2025-06-14 13:13:50 - ModelTrainerApp - INFO - Biblioteca 'imbalanced-learn' carregada com sucesso.
2025-06-14 13:13:52 - MainApp - INFO - DPI Awareness set.
2025-06-14 13:13:53 - MainApp - INFO - ScraperUploadTab instanciada.
2025-06-14 13:13:53 - PredictorApp - INFO - Modelo carregado: best_model_backdraw_best_f1.joblib (Modif.: 2025-05-13 19:01:25)
2025-06-14 13:13:53 - PredictorApp - INFO -   Tipo: LogisticRegression | Calib: Sim | F1 Thr: 0.2674 | EV Thr: 0.2300
2025-06-14 13:13:53 - PredictorApp - INFO - Modelo carregado: best_model_backdraw_best_roi.joblib (Modif.: 2025-05-13 19:01:25)
2025-06-14 13:13:53 - PredictorApp - INFO -   Tipo: GaussianNB | Calib: Sim | F1 Thr: 0.2525 | EV Thr: 0.2500
2025-06-14 13:13:53 - DataHandler - INFO - Iniciando carregamento/mapeamento histórico (FILTRO DE LIGA HISTÓRICO ATIVO por TARGET_LEAGUES_INTERNAL_IDS)...
2025-06-14 13:13:53 - DataHandler - INFO - -- Processando arquivo: dados_combinados_2019_2025.xlsx --
2025-06-14 13:13:53 - DataHandler - INFO - Lendo dados_combinados_2019_2025.xlsx (formato: .xlsx)...
2025-06-14 13:14:36 - DataHandler - INFO -   -> Lido 97670 linhas de dados_combinados_2019_2025.xlsx.
2025-06-14 13:14:36 - DataHandler - INFO - (dados_combinados_2019_2025.xlsx) Mapeando coluna de liga 'League'...
2025-06-14 13:14:36 - DataHandler - WARNING -   (dados_combinados_2019_2025.xlsx) Ligas NÃO mapeadas para ID Interno: ['Austria 2. Liga', 'Austria Bundesliga', 'Belgium Pro League', 'Bulgaria First League', 'Chile Primera División', 'China Chinese Super League', 'Croatia Prva HNL', 'Czech Republic First League', 'Denmark Superliga', 'Egypt Egyptian Premier League', 'England Championship', 'England EFL League One', 'England EFL League Two', 'England Premier League', 'Estonia Meistriliiga', 'Finland Veikkausliiga', 'France Ligue 1', 'France Ligue 2', 'Germany 2. Bundesliga', 'Germany Bundesliga', 'Greece Super League', 'Iceland Úrvalsdeild', 'Japan J1 League', 'Japan J2 League', 'Netherlands Eerste Divisie', 'Netherlands Eredivisie', 'Norway Eliteserien', 'Norway First Division', 'Paraguay Division Profesional', 'Poland Ekstraklasa', 'Portugal Liga NOS', 'Portugal LigaPro', 'Republic of Ireland Premier Division', 'Scotland Premiership', 'Slovakia Super Liga', 'Slovenia PrvaLiga', 'South Korea K League 1', 'South Korea K League 2', 'Spain La Liga', 'Sweden Allsvenskan', 'Sweden Superettan', 'Switzerland Challenge League', 'Switzerland Super League', 'Turkey Süper Lig', 'USA MLS', 'Uruguay Primera División', 'Wales Welsh Premier League']
2025-06-14 13:14:36 - DataHandler - INFO -   (dados_combinados_2019_2025.xlsx) APLICANDO FILTRO por TARGET_LEAGUES_INTERNAL_IDS...
2025-06-14 13:14:36 - DataHandler - INFO -     -> Filtro de Liga: 18177/97670 jogos restantes.
2025-06-14 13:14:36 - DataHandler - INFO -   -> Arquivo dados_combinados_2019_2025.xlsx processado com sucesso (Shape: (18177, 20)).
2025-06-14 13:14:36 - DataHandler - INFO - Concatenando 1 DataFrames processados...
2025-06-14 13:14:36 - DataHandler - INFO - DataFrame histórico combinado antes do pós-processamento: (18177, 20)
2025-06-14 13:14:36 - DataHandler - INFO - Iniciando processamento comum pós-concatenação...
2025-06-14 13:14:36 - DataHandler - INFO -   -> Conversão de 'Date' concluída. 0 NaNs restantes em Date (deveria ser 0).
2025-06-14 13:14:36 - DataHandler - INFO -   Verificando NaNs essenciais em: ['Date', 'Home', 'Away', 'Goals_H_FT', 'Goals_A_FT', 'Odd_H_FT', 'Odd_D_FT', 'Odd_A_FT']
2025-06-14 13:14:36 - DataHandler - INFO -   Removidas 239 linhas devido a NaNs em colunas essenciais.
2025-06-14 13:14:36 - DataHandler - INFO -   DataFrame histórico ordenado por data.
2025-06-14 13:14:36 - DataHandler - INFO -   Calculando Pi-Ratings finais...
2025-06-14 13:14:36 - DataHandler - INFO - Calculando Pi-Ratings e Momentum (Janela=5)...
2025-06-14 13:14:38 - DataHandler - INFO - Pi-Ratings/Momentum calculados. Colunas: ['PiRating_H', 'PiRating_A', 'PiRating_Diff', 'PiRating_Prob_H', 'PiR_Mom_5G_H', 'PiR_Mom_5G_A', 'PiR_Mom_5G_Diff']
2025-06-14 13:14:38 - DataHandler - INFO - Processamento pós-concatenação concluído.
2025-06-14 13:14:38 - DataHandler - INFO - Carregamento e processamento de dados históricos concluídos (FILTRO DE LIGA HISTÓRICO ATIVO por TARGET_LEAGUES_INTERNAL_IDS). Shape Final: (17938, 27)
2025-06-14 13:14:38 - DataHandler - INFO - Contagem de NaNs finais (em colunas com algum NaN):
Odd_Over25_FT      156
Odd_Under25_FT     156
Odd_BTTS_Yes       154
Odd_BTTS_No        154
PiR_Mom_5G_H       591
PiR_Mom_5G_A       616
PiR_Mom_5G_Diff    793
dtype: int64
2025-06-14 13:14:38 - MainApp - INFO - FootballPredictorDashboard instanciada.
2025-06-14 13:14:38 - MainApp - INFO - FeatureAnalyzerApp instanciada.
2025-06-14 13:14:38 - MainApp - INFO - ModelInterpreterApp instanciada.
2025-06-14 13:28:58 - DataHandler - INFO - Iniciando carregamento/mapeamento histórico (FILTRO DE LIGA HISTÓRICO ATIVO por TARGET_LEAGUES_INTERNAL_IDS)...
2025-06-14 13:28:58 - DataHandler - INFO - -- Processando arquivo: dados_combinados_2019_2025.xlsx --
2025-06-14 13:28:58 - DataHandler - INFO - Lendo dados_combinados_2019_2025.xlsx (formato: .xlsx)...
2025-06-14 13:29:40 - DataHandler - INFO -   -> Lido 97670 linhas de dados_combinados_2019_2025.xlsx.
2025-06-14 13:29:40 - DataHandler - INFO - (dados_combinados_2019_2025.xlsx) Mapeando coluna de liga 'League'...
2025-06-14 13:29:40 - DataHandler - WARNING -   (dados_combinados_2019_2025.xlsx) Ligas NÃO mapeadas para ID Interno: ['Austria 2. Liga', 'Austria Bundesliga', 'Belgium Pro League', 'Bulgaria First League', 'Chile Primera División', 'China Chinese Super League', 'Croatia Prva HNL', 'Czech Republic First League', 'Denmark Superliga', 'Egypt Egyptian Premier League', 'England Championship', 'England EFL League One', 'England EFL League Two', 'England Premier League', 'Estonia Meistriliiga', 'Finland Veikkausliiga', 'France Ligue 1', 'France Ligue 2', 'Germany 2. Bundesliga', 'Germany Bundesliga', 'Greece Super League', 'Iceland Úrvalsdeild', 'Japan J1 League', 'Japan J2 League', 'Netherlands Eerste Divisie', 'Netherlands Eredivisie', 'Norway Eliteserien', 'Norway First Division', 'Paraguay Division Profesional', 'Poland Ekstraklasa', 'Portugal Liga NOS', 'Portugal LigaPro', 'Republic of Ireland Premier Division', 'Scotland Premiership', 'Slovakia Super Liga', 'Slovenia PrvaLiga', 'South Korea K League 1', 'South Korea K League 2', 'Spain La Liga', 'Sweden Allsvenskan', 'Sweden Superettan', 'Switzerland Challenge League', 'Switzerland Super League', 'Turkey Süper Lig', 'USA MLS', 'Uruguay Primera División', 'Wales Welsh Premier League']
2025-06-14 13:29:40 - DataHandler - INFO -   (dados_combinados_2019_2025.xlsx) APLICANDO FILTRO por TARGET_LEAGUES_INTERNAL_IDS...
2025-06-14 13:29:40 - DataHandler - INFO -     -> Filtro de Liga: 18177/97670 jogos restantes.
2025-06-14 13:29:40 - DataHandler - INFO -   -> Arquivo dados_combinados_2019_2025.xlsx processado com sucesso (Shape: (18177, 20)).
2025-06-14 13:29:40 - DataHandler - INFO - Concatenando 1 DataFrames processados...
2025-06-14 13:29:40 - DataHandler - INFO - DataFrame histórico combinado antes do pós-processamento: (18177, 20)
2025-06-14 13:29:40 - DataHandler - INFO - Iniciando processamento comum pós-concatenação...
2025-06-14 13:29:40 - DataHandler - INFO -   -> Conversão de 'Date' concluída. 0 NaNs restantes em Date (deveria ser 0).
2025-06-14 13:29:40 - DataHandler - INFO -   Verificando NaNs essenciais em: ['Date', 'Home', 'Away', 'Goals_H_FT', 'Goals_A_FT', 'Odd_H_FT', 'Odd_D_FT', 'Odd_A_FT']
2025-06-14 13:29:40 - DataHandler - INFO -   Removidas 239 linhas devido a NaNs em colunas essenciais.
2025-06-14 13:29:40 - DataHandler - INFO -   DataFrame histórico ordenado por data.
2025-06-14 13:29:40 - DataHandler - INFO -   Calculando Pi-Ratings finais...
2025-06-14 13:29:40 - DataHandler - INFO - Calculando Pi-Ratings e Momentum (Janela=5)...
2025-06-14 13:29:42 - DataHandler - INFO - Pi-Ratings/Momentum calculados. Colunas: ['PiRating_H', 'PiRating_A', 'PiRating_Diff', 'PiRating_Prob_H', 'PiR_Mom_5G_H', 'PiR_Mom_5G_A', 'PiR_Mom_5G_Diff']
2025-06-14 13:29:42 - DataHandler - INFO - Processamento pós-concatenação concluído.
2025-06-14 13:29:42 - DataHandler - INFO - Carregamento e processamento de dados históricos concluídos (FILTRO DE LIGA HISTÓRICO ATIVO por TARGET_LEAGUES_INTERNAL_IDS). Shape Final: (17938, 27)
2025-06-14 13:29:42 - DataHandler - INFO - Contagem de NaNs finais (em colunas com algum NaN):
Odd_Over25_FT      156
Odd_Under25_FT     156
Odd_BTTS_Yes       154
Odd_BTTS_No        154
PiR_Mom_5G_H       591
PiR_Mom_5G_A       616
PiR_Mom_5G_Diff    793
dtype: int64
2025-06-14 13:29:42 - DataHandler - INFO - --- Iniciando Pipeline Pré-proc e Feature Eng (Histórico) ---
2025-06-14 13:29:42 - DataHandler - INFO - Médias Liga (FA/FD, Poisson): Casa=1.353, Fora=1.045
2025-06-14 13:29:42 - DataHandler - INFO - === ETAPA 1: Intermediárias e Probs ===
2025-06-14 13:29:42 - DataHandler - INFO - Calculando stats intermediárias (Result, IsDraw, Ptos)...
2025-06-14 13:29:42 - DataHandler - INFO - -> Colunas de Gols encontradas: 'Goals_H_FT' e 'Goals_A_FT'.
2025-06-14 13:29:42 - DataHandler - INFO - ->Result/IsDraw/Ptos OK.
2025-06-14 13:29:42 - DataHandler - INFO - Cálculo Intermediárias (Result/IsDraw/Ptos) concluído.
2025-06-14 13:29:42 - DataHandler - INFO - Probabilidades Implícitas (p_H, p_D, p_A) calculadas.
2025-06-14 13:29:42 - DataHandler - INFO - Probabilidades Normalizadas (p_X_norm, abs_ProbDiff_Norm) calculadas.
2025-06-14 13:29:42 - DataHandler - INFO - === ETAPA 1.5: VG_raw e CG_raw ===
2025-06-14 13:29:42 - DataHandler - INFO - Calculando VG_raw e CG_raw...
2025-06-14 13:29:42 - DataHandler - INFO - -> VG_raw e CG_raw calculados.
2025-06-14 13:29:42 - DataHandler - INFO - === ETAPA 2: PiRatings ===
2025-06-14 13:29:42 - DataHandler - INFO - Calculando Pi-Ratings e Momentum (Janela=5)...
2025-06-14 13:29:44 - DataHandler - INFO - Pi-Ratings/Momentum calculados. Colunas: ['PiRating_H', 'PiRating_A', 'PiRating_Diff', 'PiRating_Prob_H', 'PiR_Mom_5G_H', 'PiR_Mom_5G_A', 'PiR_Mom_5G_Diff']
2025-06-14 13:29:44 - DataHandler - INFO - === ETAPA 3: Rolling Stats ===
2025-06-14 13:29:44 - DataHandler - INFO - Calculando 8 métricas rolling (Janela Padrão=5)...
2025-06-14 13:29:55 - DataHandler - INFO - Métricas rolling calculadas. Shape: (17938, 16).
2025-06-14 13:29:55 - DataHandler - INFO - === ETAPA 4: EWMA Stats ===
2025-06-14 13:29:55 - DataHandler - INFO - Calculando 4 métricas EWMA (Span Padrão=5)...
2025-06-14 13:30:21 - DataHandler - INFO - Métricas EWMA calculadas. Shape: (17938, 8).
2025-06-14 13:30:21 - DataHandler - INFO - === ETAPA 5: FA/FD ===
2025-06-14 13:30:21 - DataHandler - INFO - === ETAPA 6: Poisson, Binned, Derivadas ===
2025-06-14 13:30:21 - DataHandler - INFO - Calculando Prob Empate (Poisson Refinado, max_goals=6)...
2025-06-14 13:30:21 - DataHandler - INFO - Prob_Empate_Poisson (Refinado) calculado.
2025-06-14 13:30:21 - DataHandler - INFO - Binning ('Odd_D_Cat') calculado a partir de 'Odd_D_FT'.
2025-06-14 13:30:21 - DataHandler - INFO - Calculando features derivadas (CV_HDA, Diff_Media_CG, Novas Interações)...
2025-06-14 13:30:21 - DataHandler - INFO - Features de interação calculadas (incluindo novas).
2025-06-14 13:30:21 - DataHandler - INFO - === FIM PIPELINE FEATURE ENG (HISTÓRICO) ===
2025-06-14 13:30:21 - DataHandler - INFO - --- Selecionando e Limpando Features Finais ---
2025-06-14 13:30:21 - DataHandler - INFO - Features finais a serem usadas para o modelo: ['Prob_Empate_Poisson', 'abs_ProbDiff_Norm', 'Odd_Over25_FT', 'CV_HDA', 'PiR_Mom_5G_A', 'Media_VG_H', 'Media_VG_A']
2025-06-14 13:30:21 - DataHandler - INFO - DataFrame selecionado com features e alvo (antes do dropna): (17938, 8)
2025-06-14 13:30:21 - DataHandler - WARNING - NaNs ANTES do dropna final nas features selecionadas:
Odd_Over25_FT    156
PiR_Mom_5G_A     616
Media_VG_H       107
Media_VG_A       135
dtype: int64
2025-06-14 13:30:21 - DataHandler - INFO - Removidas 791 linhas contendo NaNs/Infs nas features finais ou no alvo.
2025-06-14 13:30:21 - DataHandler - INFO - --- Seleção e Limpeza de Features Finais Concluída --- Shape X: (17147, 7), Shape y: (17147,).
2025-06-14 13:30:21 - DataHandler - INFO - Calculando stats intermediárias (Result, IsDraw, Ptos)...
2025-06-14 13:30:21 - DataHandler - INFO - -> Colunas de Gols encontradas: 'Goals_H_FT' e 'Goals_A_FT'.
2025-06-14 13:30:21 - DataHandler - INFO - ->Result/IsDraw/Ptos OK.
2025-06-14 13:30:21 - DataHandler - INFO - Cálculo Intermediárias (Result/IsDraw/Ptos) concluído.
2025-06-14 13:30:21 - Main2 - INFO - DEBUG Main: df_full_data_aligned_for_split (17147, 31)
2025-06-14 13:30:21 - ModelTrainerApp - INFO - --- Iniciando Treinamento Otimizado para 7 Modelos Individuais ---
2025-06-14 13:30:21 - ModelTrainerApp - INFO - Dividindo dados temporalmente (Treino+CV / Teste Final)...
2025-06-14 13:30:21 - ModelTrainerApp - INFO - Split Temporal: T+CV=13718 (80.0%), Teste=3429 (20.0%)
2025-06-14 13:30:21 - ModelTrainerApp - INFO - Odds alinhadas com o conjunto de teste: 3429 jogos.
2025-06-14 13:30:21 - ModelTrainerApp - INFO - 
--- Mod 1/7 (RandomForestClassifier): Iniciando ---
2025-06-14 13:30:21 - ModelTrainerApp - INFO -   Pipeline base criado (Sampler: SMOTE, Classifier: RandomForestClassifier)
2025-06-14 13:30:21 - ModelTrainerApp - INFO -   Iniciando BayesSearchCV para RandomForestClassifier (Score: f1, CV: Temporal)...
2025-06-14 13:36:56 - ModelTrainerApp - INFO -     -> Busca CV (BayesSearchCV) OK. Melhor CV f1: 0.4199. Params: {'bootstrap': True, 'class_weight': None, 'max_depth': 5, 'max_features': 'sqrt', 'min_samples_leaf': 6, 'min_samples_split': 62, 'n_estimators': 232}
2025-06-14 13:36:56 - ModelTrainerApp - INFO -   Re-ajustando MELHOR pipeline (da CV) para RandomForestClassifier em todos os dados de treino+CV...
2025-06-14 13:36:57 - ModelTrainerApp - INFO -   -> Treino final do pipeline para RandomForestClassifier OK.
2025-06-14 13:36:58 - ModelTrainerApp - WARNING - Mod 1/7 (RandomForestClassifier) AVISO: Calibração e Otim. Limiares no CONJUNTO DE TESTE (avaliação otimista).
2025-06-14 13:36:58 - Calibrators - INFO - SigmoidCalibrator (Platt) inicializado.
2025-06-14 13:36:58 - ModelTrainerApp - INFO -   Calibrando probs (sigmoid) para RandomForestClassifier...
2025-06-14 13:36:58 - Calibrators - INFO - SigmoidCalibrator ajustado com sucesso.
2025-06-14 13:36:58 - ModelTrainerApp - INFO -   -> Calibrador (sigmoid) ajustado e probabilidades previstas para RandomForestClassifier.
2025-06-14 13:36:58 - ModelTrainerApp - INFO -     Limiar F1 (sigmoid): 0.2085 (F1=0.4666)
2025-06-14 13:36:58 - ModelTrainerApp - ERROR -   Erro otim. EV RandomForestClassifier: type object 'BettingMetricsCalculator' has no attribute 'calculate_metrics_with_ev'
2025-06-14 13:36:58 - ModelTrainerApp - INFO -     Limiar Prec (sigmoid): 0.3335 (P=0.3519, R=0.2527)
2025-06-14 13:36:58 - ModelTrainerApp - INFO -   Avaliando Modelo FINAL (RandomForestClassifier) no Teste...
2025-06-14 13:36:58 - ModelTrainerApp - INFO -     Métricas @0.5: F1=0.4393, P=0.3291, R=0.6605
2025-06-14 13:36:58 - ModelTrainerApp - INFO -     Métricas @F1Opt(0.2085): F1=0.4666, P=0.3064, R=0.9785
2025-06-14 13:36:58 - ModelTrainerApp - INFO -     Métricas @PrecOpt(0.3335): F1=0.2942, P=0.3519, R=0.2527
2025-06-14 13:36:58 - ModelTrainerApp - INFO -     AUC(Calib)=0.5535, Brier(Calib)=0.2077, LogLoss(Raw)=0.6838
2025-06-14 13:36:58 - Main2 - ERROR - Erro no pipeline de treino: type object 'BettingMetricsCalculator' has no attribute 'calculate_metrics_with_ev'
Traceback (most recent call last):
  File "c:\Users\princ\Desktop\modelagem\Modelagem_Exemplos\futebol_analytics\src\main.py", line 678, in _run_training_pipeline
    success = run_training_process(
        X=X_processed, y=y_processed,
    ...<6 lines>...
        optimize_f1_threshold_flag=optimize_f1,
    )
  File "c:\Users\princ\Desktop\modelagem\Modelagem_Exemplos\futebol_analytics\src\model_trainer.py", line 834, in train_evaluate_and_save_best_models
    model_metrics = _evaluate_model_on_test_set(
        final_trained_pipeline, X_test_for_this_model, y_test_data, raw_test_probas_full,
        final_probas_for_eval, f1_thr, ev_thr, prec_thr,
        X_test_odds_data_aligned, odd_draw_col_name, current_model_name
    )
  File "c:\Users\princ\Desktop\modelagem\Modelagem_Exemplos\futebol_analytics\src\model_trainer.py", line 678, in _evaluate_model_on_test_set
    roi,bets,prof = BettingMetricsCalculator.calculate_metrics_with_ev(y_test_eval,y_proba_final_draw_test_eval,opt_ev_thr_eval,X_test_odds_eval,odd_draw_col_name_eval)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: type object 'BettingMetricsCalculator' has no attribute 'calculate_metrics_with_ev'
2025-06-14 13:39:17 - MainApp - INFO - Fechando aplicação.
2025-06-14 13:39:17 - MainApp - INFO - Destruindo janela principal.
